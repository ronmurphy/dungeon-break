/* ════════════════════════════════════════
   DICE BROKER — Mobile-first gothic CSS
   Matches: dark stone + candle mockup
   ════════════════════════════════════════ */

:root {
  --bg:        #0d0b09;
  --stone:     #181410;
  --stone2:    #201c14;
  --stone3:    #2a2418;
  --border-g:  #3a3020;
  --gold:      #c8980a;
  --gold-lt:   #f0c040;
  --gold-dim:  #7a5a08;
  --red-deep:  #3a0808;
  --red-glow:  #8b1a1a;
  --text-1:    #e8d8b0;
  --text-2:    #a08858;
  --text-3:    #604830;
  --candle-o:  #ff9a28;
  --ember:     #ff5500;

  --d4:   #e84040;
  --d6:   #e87820;
  --d8:   #d4b800;
  --d10:  #28c8e8;
  --d12:  #28d890;
  --d20:  #8870f8;
  --d100: #e850a8;
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  background: var(--bg);
  font-family: 'Crimson Text', Georgia, serif;
  color: var(--text-1);
  touch-action: manipulation;
}

/* ── Embers ── */
#ember-layer {
  position: fixed; inset: 0;
  pointer-events: none; z-index: 0;
  overflow: hidden;
}
.ember {
  position: absolute;
  bottom: -8px; border-radius: 50%;
  background: var(--ember);
  box-shadow: 0 0 5px 1px var(--candle-o);
  animation: rise linear infinite;
  pointer-events: none;
}
@keyframes rise {
  0%   { transform: translateY(0) translateX(0) scale(1); opacity: .8; }
  60%  { opacity: .4; }
  100% { transform: translateY(-100vh) translateX(15px) scale(.1); opacity: 0; }
}

/* ── Screens ── */
.screen {
  display: none;
  position: fixed; inset: 0;
  flex-direction: column;
  z-index: 2;
  overflow: hidden;
}
.screen.active { display: flex; }

/* ── Shared backgrounds ── */
.setup-bg, .game-bg {
  position: absolute; inset: 0;
  pointer-events: none; z-index: 0;
  background:
    radial-gradient(ellipse 70% 50% at 15% 90%, rgba(180,70,0,.18) 0%, transparent 60%),
    radial-gradient(ellipse 60% 40% at 85% 85%, rgba(180,90,0,.14) 0%, transparent 55%),
    radial-gradient(ellipse 80% 60% at 50% 5%, rgba(80,30,0,.20) 0%, transparent 60%),
    repeating-linear-gradient(91deg, transparent 0, rgba(0,0,0,.04) 1px, transparent 2px, transparent 80px),
    repeating-linear-gradient(180deg, transparent 0, rgba(255,150,20,.015) 1px, transparent 2px, transparent 100px);
}

/* ═══════════════════════════════════════
   SETUP SCREEN
   ═══════════════════════════════════════ */
#setup-screen {
  align-items: center;
  justify-content: flex-start;
  overflow-y: auto;
}

.setup-inner {
  width: 100%; max-width: 480px;
  margin: 0 auto;
  display: flex; flex-direction: column;
  gap: 0; padding: 0 0 2rem;
  position: relative; z-index: 2;
}

/* Title block */
.title-block {
  text-align: center;
  padding: 1.5rem 1rem 0.8rem;
}

.candle-row {
  display: flex; align-items: flex-end;
  justify-content: center; gap: 1rem;
  margin-bottom: 0.5rem;
}

.candle {
  width: 10px; height: 40px;
  background: linear-gradient(180deg, #e8d080 0%, #c8a040 40%, #7a5818 100%);
  border-radius: 2px 2px 0 0;
  position: relative;
}
.flame {
  position: absolute; top: -14px; left: 50%;
  transform: translateX(-50%);
  width: 10px; height: 18px;
  background: radial-gradient(ellipse at 50% 80%, #fff 0%, #ffdd44 30%, #ff9900 60%, transparent 100%);
  border-radius: 50% 50% 30% 30%;
  animation: flicker 1.5s ease-in-out infinite alternate;
  filter: blur(1px);
}
@keyframes flicker {
  from { transform: translateX(-50%) scaleX(1) scaleY(1) rotate(-2deg); opacity: .9; }
  to   { transform: translateX(-50%) scaleX(.85) scaleY(1.1) rotate(2deg); opacity: 1; }
}

.title-fence {
  font-size: 0.9rem; color: var(--gold-dim);
  letter-spacing: 0.1em; padding-bottom: 4px;
}

.main-title {
  font-family: 'Cinzel Decorative', serif;
  font-size: clamp(2.6rem, 12vw, 4.2rem);
  font-weight: 900;
  line-height: 1.0;
  color: var(--gold-lt);
  text-shadow:
    0 0 30px rgba(200,140,0,.7),
    0 0 60px rgba(200,100,0,.4),
    3px 3px 0 rgba(0,0,0,.8);
  letter-spacing: 0.05em;
}

.title-sub {
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  letter-spacing: 0.25em;
  color: var(--text-3);
  text-transform: uppercase;
  margin-top: 0.4rem;
}

.title-divider {
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold-dim), transparent);
  margin: 0.8rem auto;
  width: 80%;
}

/* Setup card */
.setup-card {
  margin: 0 0.8rem;
  background: linear-gradient(160deg, var(--stone2) 0%, var(--stone) 100%);
  border: 1px solid var(--gold-dim);
  outline: 1px solid rgba(200,150,10,.1);
  outline-offset: 3px;
  border-radius: 4px;
  padding: 1.4rem 1.2rem;
  display: flex; flex-direction: column; gap: 1.2rem;
  box-shadow: inset 0 0 30px rgba(0,0,0,.5), 0 8px 30px rgba(0,0,0,.7);
  position: relative;
}
.setup-card::before { content:'◆'; position:absolute; top:5px; left:7px; color:var(--gold-dim); font-size:.55rem; opacity:.7; }
.setup-card::after  { content:'◆'; position:absolute; bottom:5px; right:7px; color:var(--gold-dim); font-size:.55rem; opacity:.7; }

.opt-group { display:flex; flex-direction:column; gap:.4rem; }
.opt-label {
  font-family: 'Cinzel', serif;
  font-size: .65rem; font-weight:700;
  letter-spacing: .2em; color:var(--gold);
  text-transform: uppercase;
}
.opt-row { display:flex; gap:.4rem; }
.s-btn {
  flex:1; padding:.55rem .3rem;
  background: rgba(0,0,0,.4);
  border: 1px solid var(--gold-dim); border-radius:2px;
  color: var(--text-2); cursor:pointer;
  transition: all .2s;
  display:flex; flex-direction:column; align-items:center; gap:.1rem;
  font-family: 'Cinzel', serif;
}
.s-btn:hover { background: rgba(200,150,10,.1); color:var(--text-1); border-color:var(--gold); }
.s-btn.active { background: rgba(200,150,10,.18); border-color:var(--gold-lt); color:var(--gold-lt); box-shadow: inset 0 0 10px rgba(200,150,10,.15); }
.s-title { font-weight:700; font-size:.8rem; }
.s-sub { font-size:.62rem; opacity:.75; font-family:'Crimson Text',serif; }

.rules-box {
  background: rgba(0,0,0,.3);
  border: 1px solid rgba(200,150,10,.18);
  border-radius: 2px; padding:.9rem 1rem;
}
.rules-title {
  font-family:'Cinzel',serif; font-size:.68rem;
  letter-spacing:.15em; color:var(--gold);
  text-transform:uppercase; margin-bottom:.5rem;
}
.rules-ul { list-style:none; display:flex; flex-direction:column; gap:.28rem; }
.rules-ul li {
  font-size:.84rem; color:var(--text-2);
  padding-left:1rem; position:relative; line-height:1.35;
}
.rules-ul li::before { content:'›'; position:absolute; left:0; color:var(--gold); }
.rules-ul b { color:var(--text-1); }

.upgrade-chain {
  display:flex; align-items:center; justify-content:center;
  gap:.3rem; margin-top:.7rem; flex-wrap:wrap;
  font-family:'Cinzel',serif; font-weight:700; font-size:.78rem;
}
.ch-arr { color:var(--gold-dim); }

/* Roll button (reused) */
.roll-btn {
  width:100%; padding:.85rem;
  background: linear-gradient(180deg, #c09010 0%, #7a5a05 100%);
  border: 1px solid var(--gold-lt); border-radius:3px;
  color:#fffbe0;
  font-family:'Cinzel',serif; font-size:.92rem; font-weight:700;
  letter-spacing:.1em; cursor:pointer;
  transition: all .2s;
  text-transform: uppercase;
  box-shadow: 0 2px 8px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,220,80,.3);
}
.roll-btn:hover { background: linear-gradient(180deg,#d8a820 0%,#9a7010 100%); transform:translateY(-1px); box-shadow:0 0 20px rgba(200,150,10,.4), 0 4px 12px rgba(0,0,0,.6); }
.roll-btn:active { transform:translateY(0); }
.roll-btn-secondary { background: linear-gradient(180deg,#3a3020 0%,#201808 100%); border-color:var(--gold-dim); }

/* ═══════════════════════════════════════
   GAME SCREEN
   ═══════════════════════════════════════ */
#game-screen {
  display: none;
  flex-direction: column;
}
#game-screen.active { display: flex; }

/* Top bar */
#top-bar {
  display: flex; align-items: center;
  justify-content: space-between;
  padding: .4rem .8rem;
  background: linear-gradient(180deg, rgba(8,6,3,1) 0%, rgba(8,6,3,0) 100%);
  border-bottom: 1px solid var(--gold-dim);
  flex-shrink: 0; z-index: 5;
  gap: .5rem;
}
.top-logo {
  font-family:'Cinzel Decorative',serif; font-size:.9rem;
  color:var(--gold-lt);
  text-shadow: 0 0 10px rgba(200,130,0,.5);
  white-space:nowrap;
}
.round-pill {
  font-family:'Cinzel',serif;
  background:rgba(200,150,10,.12); border:1px solid var(--gold-dim);
  border-radius:20px; padding:.12rem .6rem;
  font-size:.65rem; font-weight:700; color:var(--gold);
  white-space:nowrap;
}
.top-right-info { display:flex; align-items:center; gap:.4rem; }
.diff-pill {
  font-family:'Cinzel',serif;
  background:rgba(200,150,10,.2); border:1px solid var(--gold);
  border-radius:2px; padding:.1rem .45rem;
  font-size:.6rem; font-weight:700; color:var(--gold-lt);
  text-transform:uppercase; letter-spacing:.08em;
}
#target-pill { font-size:.72rem; color:var(--text-2); white-space:nowrap; }

/* Leaderboard strip */
#leader-strip {
  display: flex; gap:.4rem;
  padding:.35rem .7rem;
  background: rgba(0,0,0,.4);
  border-bottom: 1px solid rgba(200,150,10,.12);
  overflow-x: auto; flex-shrink:0;
  z-index:4;
}
.leader-card {
  display:flex; flex-direction:column; align-items:center;
  gap:.1rem; flex-shrink:0;
  background: rgba(0,0,0,.3);
  border:1px solid var(--border-g); border-radius:3px;
  padding:.2rem .5rem; min-width:54px;
}
.leader-card.you-card { border-color:var(--gold); background:rgba(200,150,10,.08); }
.leader-card.winner-card { border-color:var(--gold-lt); box-shadow:0 0 10px rgba(240,192,64,.3); animation:lb-pulse .5s ease 3; }
.leader-card.loser-card { border-color:#aa2020; animation:lb-shake .3s ease 2; }
.leader-card.elim-card { opacity:.3; filter:grayscale(.8); }
@keyframes lb-pulse { 0%,100%{box-shadow:0 0 8px rgba(240,192,64,.2)} 50%{box-shadow:0 0 20px rgba(240,192,64,.6)} }
@keyframes lb-shake { 0%,100%{transform:translateX(0)} 30%{transform:translateX(-3px)} 70%{transform:translateX(3px)} }
.lc-name { font-family:'Cinzel',serif; font-size:.55rem; font-weight:700; color:var(--text-1); }
.lc-dice { display:flex; flex-wrap:wrap; gap:2px; justify-content:center; }
.lc-chip {
  width:16px; height:16px; border-radius:2px;
  display:inline-flex; align-items:center; justify-content:center;
  font-family:'Cinzel',serif; font-size:.42rem; font-weight:900; color:#000;
}
.lc-score { font-size:.6rem; color:var(--gold); font-family:'Cinzel',serif; }
.lc-d100 { display:flex; gap:2px; }
.lc-dot { width:5px; height:5px; border-radius:1px; border:1px solid var(--text-3); }
.lc-dot.filled { background:var(--d100); border-color:var(--d100); }

/* Mid area */
#mid-area {
  flex:1; display:flex;
  overflow:hidden; z-index:3;
}

/* Rolling tray */
#tray-wrap {
  flex:1; position:relative;
  display:flex; flex-direction:column; align-items:center;
  border-right:1px solid rgba(200,150,10,.15);
  background:
    radial-gradient(ellipse 80% 60% at 50% 50%, rgba(60,10,10,.5) 0%, transparent 70%),
    #0d0a07;
}
.zone-label {
  font-family:'Cinzel',serif; font-size:.58rem;
  letter-spacing:.2em; color:var(--gold-dim);
  text-transform:uppercase; padding:.3rem 0 0;
  position:absolute; top:0; left:50%; transform:translateX(-50%);
  z-index:2; white-space:nowrap;
}
#tray-canvas {
  width:100% !important; height:100% !important; display:block;
}
#tray-overlay {
  position:absolute; inset:0; pointer-events:none;
  display:flex; flex-direction:column; align-items:center; justify-content:flex-end;
  padding-bottom:0.5rem;
}
.tray-hint {
  font-family:'Cinzel',serif; font-size:.65rem;
  color:var(--text-3); letter-spacing:.1em;
  text-align:center; padding:.3rem .8rem;
}
.tray-result {
  background:rgba(0,0,0,.85); border:1px solid var(--gold);
  border-radius:3px; padding:.4rem 1rem;
  font-family:'Cinzel',serif; font-size:1rem; font-weight:700;
  color:var(--gold-lt); text-align:center;
  box-shadow:0 0 18px rgba(200,150,10,.3);
  animation:pop .3s cubic-bezier(.34,1.56,.64,1);
}
@keyframes pop { from{transform:scale(.7);opacity:0} to{transform:scale(1);opacity:1} }
.tray-result.hidden { display:none; }

/* Dice Rack (right side) */
#rack-wrap {
  width: 90px;
  display:flex; flex-direction:column; align-items:center;
  padding:.5rem .3rem;
  overflow-y:auto; overflow-x:hidden;
  background: linear-gradient(180deg,#141008 0%,#0e0a06 100%);
  border-left: none;
  position:relative; z-index:4;
}
#rack-wrap .zone-label {
  position:relative; left:auto; transform:none;
  top:auto; margin-bottom:.4rem;
}
#rack-slots {
  display:flex; flex-direction:column;
  align-items:center; gap:.5rem; width:100%;
}

/* Individual rack die canvas */
.rack-die-wrap {
  position:relative;
  cursor:pointer;
  transition:transform .15s;
}
.rack-die-wrap:hover { transform:scale(1.06); }
.rack-die-wrap.selected .rack-sel-ring {
  opacity:1;
}
.rack-sel-ring {
  position:absolute; inset:-3px;
  border-radius:6px; border:2px solid #fff;
  pointer-events:none; opacity:0;
  transition:opacity .15s;
  box-shadow:0 0 10px #fff;
}
.rack-die-canvas { display:block; width:68px; height:68px; border-radius:5px; }

/* Bottom bar */
#bottom-bar {
  flex-shrink:0;
  background: linear-gradient(0deg, rgba(8,6,3,1) 0%, rgba(12,10,6,.95) 100%);
  border-top:1px solid var(--gold-dim);
  padding:.5rem .8rem;
  z-index:5;
  display:flex; flex-direction:column; gap:.4rem;
}

#selected-row {
  display:flex; align-items:center; gap:.4rem;
  flex-wrap:wrap; min-height:1.6rem;
}
.sel-label { font-family:'Cinzel',serif; font-size:.62rem; color:var(--text-3); text-transform:uppercase; letter-spacing:.1em; white-space:nowrap; }
#sel-chips { display:flex; gap:.25rem; flex-wrap:wrap; }
#sel-none { font-size:.78rem; color:var(--text-3); font-style:italic; }
.sel-chip {
  height:24px; padding:0 .5rem;
  border-radius:3px; display:inline-flex; align-items:center;
  font-family:'Cinzel',serif; font-size:.65rem; font-weight:900; color:#000;
  box-shadow:0 1px 4px rgba(0,0,0,.5);
}

.phase-block { display:flex; flex-direction:column; gap:.4rem; }
.phase-block.hidden { display:none; }

.choice-title { font-family:'Cinzel',serif; font-size:.7rem; color:var(--gold); letter-spacing:.1em; text-transform:uppercase; }
#choice-btns { display:flex; flex-wrap:wrap; gap:.4rem; }
.c-btn {
  flex:1; min-width:120px;
  padding:.5rem .7rem;
  background:rgba(0,0,0,.4); border:1px solid var(--gold-dim); border-radius:2px;
  color:var(--text-1); cursor:pointer;
  font-family:'Cinzel',serif; font-size:.7rem; font-weight:700;
  text-align:left; transition:all .15s;
  display:flex; flex-direction:column; gap:.1rem;
}
.c-btn:hover { background:rgba(200,150,10,.12); border-color:var(--gold); transform:translateX(2px); }
.c-btn:disabled { opacity:.3; cursor:not-allowed; transform:none; }
.c-btn-title { color:var(--gold-lt); }
.c-btn-sub { font-size:.62rem; color:var(--text-2); font-family:'Crimson Text',serif; font-weight:400; }

/* Log panel */
#log-panel {
  flex-shrink:0; height:90px; overflow:hidden;
  background:#0a0703; border-top:1px solid rgba(200,150,10,.15);
  z-index:4; display:flex; flex-direction:column;
  transition:height .3s ease;
}
#log-panel.expanded { height:180px; }
#log-header-row {
  display:flex; align-items:center; justify-content:space-between;
  padding:.2rem .7rem;
  background:rgba(0,0,0,.4); border-bottom:1px solid rgba(200,150,10,.1);
  flex-shrink:0;
}
.log-title-text { font-family:'Cinzel',serif; font-size:.58rem; letter-spacing:.15em; color:var(--gold-dim); text-transform:uppercase; }
.log-toggle-btn { background:none; border:none; color:var(--gold-dim); cursor:pointer; font-size:.7rem; padding:0 .3rem; }
#log-body { overflow-y:auto; padding:.3rem .7rem; display:flex; flex-direction:column; gap:.12rem; }
.log-e { font-family:'Crimson Text',serif; font-size:.78rem; color:var(--text-3); line-height:1.4; animation:log-in .2s ease; }
.log-e.log-round { font-family:'Cinzel',serif; font-size:.65rem; color:var(--gold-dim); letter-spacing:.08em; margin-top:.15rem; }
.log-e.log-win { color:var(--gold); }
.log-e.log-loss { color:#cc4444; }
.log-e.log-info { color:var(--d12); }
@keyframes log-in { from{opacity:0;transform:translateX(-3px)} to{opacity:1;transform:none} }

/* Pool mini */
.pool-chip {
  width:16px; height:16px; border-radius:2px;
  display:inline-flex; align-items:center; justify-content:center;
  font-family:'Cinzel',serif; font-size:.4rem; font-weight:900; color:#000;
}

/* WIN SCREEN */
#win-screen { align-items:center; justify-content:center; overflow:hidden; }
#win-shower { position:absolute; inset:0; pointer-events:none; overflow:hidden; z-index:1; }
.shower-die {
  position:absolute; top:-60px; border-radius:6px;
  display:flex; align-items:center; justify-content:center;
  font-family:'Cinzel',serif; font-weight:900; color:#000;
  animation:fall linear forwards;
}
@keyframes fall { from{transform:translateY(0) rotate(0)} to{transform:translateY(115vh) rotate(540deg);opacity:0} }

.win-wrap {
  position:relative; z-index:5;
  display:flex; flex-direction:column; align-items:center;
  gap:1rem; padding:2rem 1.5rem; text-align:center;
  max-width:420px; width:100%;
}
.win-icon-big { font-size:4.5rem; animation:pop .6s cubic-bezier(.34,1.56,.64,1); }
#win-icon { font-size:4.5rem; animation:pop .6s cubic-bezier(.34,1.56,.64,1); }
#win-headline {
  font-family:'Cinzel Decorative',serif;
  font-size:2.4rem; line-height:1.1;
}
#win-headline.win  { color:var(--gold-lt); text-shadow:0 0 30px rgba(240,192,64,.5); }
#win-headline.lose { color:#cc3333; }
#win-sub { font-size:1rem; color:var(--text-2); }
#win-stats { display:flex; gap:1.2rem; font-family:'Cinzel',serif; font-size:.8rem; color:var(--text-2); }
.pool-claim { background:linear-gradient(135deg,#1e1608,#120e05); border:1px solid var(--gold-dim); border-radius:3px; padding:.9rem 1.2rem; width:100%; }
.pc-title { font-family:'Cinzel',serif; color:var(--gold-lt); font-size:.75rem; letter-spacing:.12em; text-transform:uppercase; margin-bottom:.5rem; }
#pc-dice { display:flex; flex-wrap:wrap; gap:4px; justify-content:center; }
.pool-claim.hidden { display:none; }
#win-screen .roll-btn { max-width:280px; }

/* Scrollbar */
::-webkit-scrollbar { width:3px; height:3px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--gold-dim); border-radius:2px; }

/* Desktop layout adjustments */
@media (min-width: 600px) {
  #rack-wrap { width:110px; }
  .rack-die-canvas { width:80px; height:80px; }
}
